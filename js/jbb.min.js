!function(t){var e=function(){return function(t,e,n,a){var i=this;void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===a&&(a=1),this.red=0,this.green=0,this.blue=0,this.alpha=1,this.rgba=function(){return"rgba("+i.red+", "+i.green+", "+i.blue+", "+i.alpha+")"},this.set=function(t,e,n,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===a&&(a=1),i.red=t,i.green=e,i.blue=n,i.alpha=a},this.red=t,this.green=e,this.blue=n,this.alpha=a}}();t.jColor=e}(jBB||(jBB={})),function(t){var e=function(){return function(t){var e=this;this._get=function(){},this._put=function(t){},this._onDBOpenSuccess=function(t){e.db=t.target.result;var n=e.db.transaction([e.filename],"readwrite").objectStore(e.filename).get(1);n.onsuccess=function(){n.hasOwnProperty("result")&&n.result.hasOwnProperty("content")&&(e.content=n.result.content)},n.onerror=function(){e.db.transaction([e.filename],"readwrite").objectStore(e.filename).put({id:1,content:"test\n"}),e.content=""}},this._onDBUpgradeNeeded=function(t){e.db=t.target.result,e.db.objectStoreNames.contains(e.filename)||(e.objectStore=e.db.createObjectStore(e.filename,{keyPath:"id"}))},this._onDBOpenError=function(t){console.log(t.target.errorCode)},this.writeString=function(t){},this.readString=function(){return null},this.filename=t;var n=window.indexedDB.open("jBBIDB",1);n.onsuccess=this._onDBOpenSuccess,n.onerror=this._onDBOpenError,n.onupgradeneeded=this._onDBUpgradeNeeded}}();t.jFile=e}(jBB||(jBB={})),function(t){var e=function(){return function(t,e,n){var a=this;this.set=function(t,e,n,i){void 0===t&&(t=16),void 0===e&&(e=!1),void 0===n&&(n=!1),void 0===i&&(i=0);var o="";1==e&&(o+=i>0?i:"bold "),1==n&&(o+="oblique "),a.ctx.data.canvas.ctx.font=o+t+"px "+a.name},this.draw=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),a.ctx.data.canvas.ctx.fillStyle=a.ctx.data.color.draw.rgba(),a.ctx.data.canvas.ctx.fillText(t,e,n)},this.ctx=n,this.name=e;var i=document.createElement("style");i.type="text/css",i.innerHTML="@font-face{ font-family: '"+this.name+"'; src: url("+t+"); }",document.body.appendChild(i)}}();t.jFont=e}(jBB||(jBB={})),function(t){var e=function(){return function(t,e,n,a,i,o){var c=this;this.img=new Image,this.loaded=!1,this.frame={num:1,width:0,height:0,start:1,current:1},this.cell={columns:0,rows:0},this.hndl={x:0,y:0},this.autoMidHandle=!1,this.localMidHandle=!1,this.scaleFac={x:1,y:1},this.rotation=0,this.draw=function(t,e,n){void 0===n&&(n=1);var a=t,i=e;if(t/=c.scaleFac.x,e/=c.scaleFac.y,n>c.frame.num&&(n=c.frame.current),1==c.loaded){var o=c.getTilePos(n-1),s=t-c.hndl.x,r=e-c.hndl.y;(1==c.autoMidHandle||c.localMidHandle)&&(s-=c.frame.width/2,r-=c.frame.height/2),c.cnv.save(),c.cnv.translate(a,i),c.cnv.rotate(c.rotation*Math.PI/180),c.cnv.translate(-a,-i),c.cnv.scale(c.scaleFac.x,c.scaleFac.y),c.cnv.drawImage(c.img,o.x,o.y,c.frame.width,c.frame.height,s,r,c.frame.width,c.frame.height),c.cnv.scale(1,1),c.cnv.restore()}},this.handle=function(t,e){if(void 0===t&&(t=void 0),void 0===e&&(e=void 0),void 0===t)return 1==c.autoMidHandle||c.localMidHandle?{x:c.hndl.x+c.img.width/2,y:c.hndl.y+c.img.height/2}:c.hndl;t/=c.scaleFac.x,e/=c.scaleFac.y,c.hndl={x:t,y:e}},this.midHandle=function(t){c.localMidHandle=t},this.imageDataObject=function(){return c.ctx.clearBackbuffer(),c.ctx.data.canvas.bbf.drawImage(c.img,0,0),c.imgData=c.ctx.data.canvas.bbf.getImageData(0,0,c.img.width,c.img.height),c.imgData},this.width=function(){return c.img.width},this.height=function(){return c.img.height},this.rotate=function(t){c.rotation=t},this.scale=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1),c.scaleFac={x:t,y:e}},this.rectOverlap=function(t,e,n,a,i,o){var s=t,r=e,d=t+c.img.width,u=e+c.img.height;return!(n>d||n+i<s||a>u||a+o<r)},this.cellsPerRow=function(){return Math.floor(c.img.width/c.frame.width)},this.getTilePos=function(t){return{x:t%c.cellsPerRow()*c.frame.width,y:Math.floor(t/c.cellsPerRow())*c.frame.height}},this.getTileIndex=function(t,e){return t/c.frame.width+e/c.frame.height*c.cellsPerRow()},"string"==typeof t?(this.img.src=t,5===arguments.length?("number"==typeof e&&(this.cell.columns=e),"number"==typeof n&&(this.cell.rows=n),this.frame.num=this.cell.columns*this.cell.rows,this.ctx=i):6===arguments.length&&("number"==typeof e&&(this.frame.width=e),"number"==typeof n&&(this.frame.height=n),this.frame.num=i,this.ctx=o),this.frame.start=a,this.cnv=this.ctx.data.canvas.ctx,this.autoMidHandle=this.ctx.data.global.autoMidHandle,this.img.onload=function(t){c.loaded=!0,1===c.frame.num?(c.frame.width=c.img.width,c.frame.height=c.img.height,c.cell.columns=1,c.cell.rows=1):c.frame.num>=2&&c.cell.columns+c.cell.rows>0&&(c.frame.width=Math.floor(c.img.width/c.cell.columns),c.frame.height=Math.floor(c.img.height/c.cell.rows))}):"number"==typeof t&&(this.img.width=t,this.img.height=e,this.frame.num=n,this.ctx=a,this.img=new Image(t,e))}}();t.jImage=e}(jBB||(jBB={})),function(t){var e=function(){return function(e,n,a){var i=this;this.data={ready:!1,lastID:0,canvas:{element:null,ctx:null,bbf:null,id:"",x:0,y:0,width:640,height:480},mainLoop:"main",parentElement:null,color:{cls:new t.jColor,draw:new t.jColor(255,255,255,1)},global:{autoMidHandle:!1,alpha:1,scale:1},mouse:null,keyboard:null,time:new t.jTime,font:{current:null,default:null},db:null},this.createBackbuffer=function(){var t=document.createElement("canvas"),e=document.createTextNode("backbuffer");t.appendChild(e),t.id=i.data.canvas.id+"-bbuf",t.width=i.data.canvas.width,t.height=i.data.canvas.height,t.style.display="none",i.data.canvas.bbf=t.getContext("2d"),document.body.appendChild(t)},this.clearBackbuffer=function(){i.data.canvas.ctx.fillStyle="rgba(0, 0, 0, 0)",i.data.canvas.ctx.setTransform(1,0,0,1,0,0),i.data.canvas.ctx.fillRect(0,0,i.data.canvas.width,i.data.canvas.height)},this.getCanvasElement=function(){i.data.canvas.element=document.getElementById(i.data.canvas.id)},this.createCanvasElement=function(){i.data.canvas.element=document.createElement("canvas"),i.data.canvas.element.id=i.data.canvas.id,i.data.canvas.element.width=i.data.canvas.width,i.data.canvas.element.height=i.data.canvas.height,i.data.canvas.element.appendChild(document.createTextNode("your browser doesn't support the canvas element"));var t=document.getElementById(i.data.parentElement);t?t.appendChild(i.data.canvas.element):document.body.appendChild(i.data.canvas.element)},this.preRender=function(){i.data.canvas.ctx.save()},this.postRender=function(){i.data.canvas.ctx.restore()},this.render=function(){window.requestAnimationFrame(i.render),i.preRender(),window[i.data.mainLoop](),i.postRender()},this.mouseX=function(){return i.data.mouse.x},this.mouseY=function(){return i.data.mouse.y},this.mouseDown=function(t){return i.data.mouse.down(t)},this.mouseHit=function(t){return i.data.mouse.hit(t)},this.flushMouse=function(){i.data.mouse.flush()},this.getMouse=function(){return i.data.mouse.get()},this.keyDown=function(t){return i.data.keyboard.down(t)},this.keyHit=function(t){return i.data.keyboard.hit(t)},this.flushKeys=function(){i.data.keyboard.flush()},this.milliSecs=function(){return i.data.time.milliSecs()},this.rand=function(t,e){return i.data.time.rand(t,e)},this.cls=function(){i.data.canvas.ctx.fillStyle=i.data.color.cls.rgba(),i.data.canvas.ctx.setTransform(1,0,0,1,0,0),i.data.canvas.ctx.fillRect(0,0,i.data.canvas.width,i.data.canvas.height)},this.clsColor=function(t,e,n){i.data.color.cls.set(t,e,n)},this.color=function(t,e,n,a){void 0===t&&(t=255),void 0===e&&(e=255),void 0===n&&(n=255),void 0===a&&(a=1),i.data.color.draw.set(t,e,n,a)},this.graphicsWidth=function(){return i.data.canvas.width},this.graphicsHeight=function(){return i.data.canvas.height},this.tFormFilter=function(t){i.data.canvas.ctx.imageSmoothingEnabled=t},this.rect=function(t,e,n,a,o){void 0===o&&(o=!0),o?(i.data.canvas.ctx.fillStyle=i.data.color.draw.rgba(),i.data.canvas.ctx.fillRect(t,e,n,a)):(i.data.canvas.ctx.strokeStyle=i.data.color.draw.rgba(),i.data.canvas.ctx.strokeRect(t,e,n,a))},this.line=function(t,e,n,a){i.data.canvas.ctx.strokeStyle=i.data.color.draw.rgba(),i.data.canvas.ctx.beginPath(),i.data.canvas.ctx.moveTo(t,e),i.data.canvas.ctx.lineTo(n,a),i.data.canvas.ctx.stroke()},this.loadFont=function(e,n){return i.data.font.current=new t.jFont(e,n,i),i.data.font.current},this.setFont=function(t,e,n,a,o){void 0===e&&(e=16),void 0===n&&(n=!1),void 0===a&&(a=!1),void 0===o&&(o=0),i.data.font.current=t,i.data.font.current.set(e,n,a,o)},this.drawText=function(e,n,a){void 0===n&&(n=0),void 0===a&&(a=0),i.data.font.current instanceof t.jFont?i.data.font.current.draw(e,n,a):i.data.font.default.draw(e,n,a)},this.autoMidHandle=function(t){i.data.global.autoMidHandle=t},this.midHandle=function(t,e){t.midHandle(e)},this.loadImage=function(e,n,a,o,c){return void 0===o&&(o=1),void 0===c&&(c=1),new t.jImage(e,n,a,o,c,i)},this.loadImage2=function(e,n,a,o){return void 0===o&&(o=1),new t.jImage(e,n,a,o,i)},this.drawImage=function(t,e,n,a){void 0===a&&(a=1),t.draw(e,n,a)},this.imageWidth=function(t){return t.width()},this.imageHeight=function(t){return t.height()},this.rotateImage=function(t,e){t.rotate(e)},this.imageHandle=function(t){return 1==t.loaded?t.handle():0},this.scaleImage=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1),t.scale(e,n)},this.createImage=function(e,n,a){return new t.jImage(e,n,a,i)},this.imageRectOverlap=function(t,e,n,a,i,o,c){return t.rectOverlap(e,n,a,i,o,c)},this.loadMusic=function(e){return new t.jMusic(e)},this.playMusic=function(t){t.play()},this.openFile=function(e){return new t.jFile(e)},this.readString=function(t){return t.readString()},"number"==typeof e?(this.data.lastID++,this.data.canvas.id="jbbCanvas"+this.data.lastID,this.data.canvas.width=e,"number"==typeof n&&(this.data.canvas.height=n),"string"==typeof a&&(this.data.mainLoop=a),this.createCanvasElement()):"string"==typeof e&&(this.data.canvas.id=e,"string"==typeof n&&(this.data.mainLoop=n),this.getCanvasElement()),this.data.canvas.ctx=this.data.canvas.element.getContext("2d"),this.data.canvas.ctx.lineWidth=1,this.data.mouse=new t.jMouse(this),this.data.keyboard=new t.jKeyboard(this),this.data.font.default=new t.jFont("","Arial",this),window.onload=function(){i.data.ready=!0,i.data.canvas.element.focus()},this.createBackbuffer(),window.requestAnimationFrame(this.render)}}();t.Core=e}(jBB||(jBB={})),function(t){var e=function(){return function(t){var e=this;this.saveKeyDown=function(t){e.keys[t.keyCode]=!0},this.saveKeyUp=function(t){e.keys[t.keyCode]=!1},this.down=function(t){return e.keys[t]},this.hit=function(t){var n=e.keys[t];return e.keys[t]=!1,n},this.flush=function(){for(var t in e.keys)e.keys[t]=!1},this.ctx=t,this.ctx.data.canvas.element.onkeydown=this.saveKeyDown,this.ctx.data.canvas.element.onkeyup=this.saveKeyUp}}();t.jKeyboard=e}(jBB||(jBB={})),function(t){var e=function(){return function(t){var e=this;this.saveMousePos=function(t){var n=e.ctx.data.canvas.element.getBoundingClientRect();e.x=t.clientX-n.left,e.y=t.clientY-n.top;var a=t.changedTouches;if(a&&a.length)for(var i=0;i<t.changedTouches.length;i++)t.changedTouches[i].identifier,e.x=t.changedTouches[i].pageX-n.left,e.y=t.changedTouches[i].pageY-n.top},this.saveMouseDown=function(t){e.keys[t.button]=!0},this.saveMouseUp=function(t){e.keys[t.button]=!1},this.down=function(t){return e.keys[t]},this.hit=function(t){var n=e.keys[t];return e.keys[t]=!1,n},this.flush=function(){for(var t in e.keys)e.keys[t]=!1},this.get=function(){var t=[];for(var n in e.keys)e.keys[n]&&t.push(Number(n));return t},this.ctx=t,this.keys=[],this.ctx.data.canvas.element.onmousemove=this.saveMousePos,this.ctx.data.canvas.element.onmousedown=this.saveMouseDown,this.ctx.data.canvas.element.onmouseup=this.saveMouseUp,this.ctx.data.canvas.element.ontouchmove=this.saveMousePos,this.ctx.data.canvas.element.ontouchstart=this.saveMouseDown,this.ctx.data.canvas.element.ontouchend=this.saveMouseUp}}();t.jMouse=e}(jBB||(jBB={})),function(t){var e=function(){function t(t,e,n){var a=this;void 0===t&&(t=""),void 0===e&&(e=!0),void 0===n&&(n=!0),this.loaded=!1,this.play=function(){a.music.play()},""!==t&&this.load(t)}return t.prototype.load=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!0),this.music=new Audio(t)},t}();t.jMusic=e}(jBB||(jBB={}));var jBB,jBBContext={context:void 0};function Graphics(t,e,n){void 0===t&&(t=640),void 0===e&&(e=480),void 0===n&&(n="main"),jBBContext.context=new jBB.Core(t,e,n)}function GraphicsFrom(t,e){void 0===e&&(e="main"),jBBContext.context=new jBB.Core(t,e)}function Cls(){jBBContext.context.cls()}function ClsColor(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),jBBContext.context.clsColor(t,e,n)}function Color(t,e,n,a){void 0===t&&(t=255),void 0===e&&(e=255),void 0===n&&(n=255),void 0===a&&(a=1),jBBContext.context.color(t,e,n,a)}function GraphicsWidth(){return jBBContext.context.graphicsWidth()}function GraphicsHeight(){return jBBContext.context.graphicsHeight()}function TFormFilter(t){jBBContext.context.tFormFilter(t)}function Rect(t,e,n,a,i){void 0===i&&(i=1);jBBContext.context.rect(t,e,n,a,i)}function Line(t,e,n,a){jBBContext.context.line(t,e,n,a)}function LoadFont(t,e){return jBBContext.context.loadFont(t,e)}function SetFont(t,e,n,a){void 0===e&&(e=16),void 0===n&&(n=!1),void 0===a&&(a=!1),jBBContext.context.setFont(t,e,n,a)}function DrawText(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),jBBContext.context.drawText(t,e,n)}function AutoMidHandle(t){jBBContext.context.autoMidHandle(t)}function MidHandle(t,e){jBBContext.context.midHandle(t,e)}function LoadImage(t,e,n,a,i){return void 0===e&&(e=1),void 0===n&&(n=1),void 0===a&&(a=1),void 0===i&&(i=1),jBBContext.context.loadImage(t,e,n,a,i)}function LoadImage2(t,e,n,a){return void 0===e&&(e=1),void 0===n&&(n=1),void 0===a&&(a=1),jBBContext.context.loadImage2(t,e,n,a)}function DrawImage(t,e,n,a){void 0===a&&(a=1),jBBContext.context.drawImage(t,e,n,a)}function HandleImage(t,e,n){t.handle(e,n)}function ImageWidth(t){return jBBContext.context.imageWidth(t)}function ImageHeight(t){return jBBContext.context.imageHeight(t)}function RotateImage(t,e){jBBContext.context.rotateImage(t,e)}function ImageXHandle(t){return jBBContext.context.imageHandle(t).x}function ImageYHandle(t){return jBBContext.context.imageHandle(t).y}function ScaleImage(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1),jBBContext.context.scaleImage(t,e,n)}function CreateImage(t,e,n){return void 0===n&&(n=1),new jBB.jImage(t,e,n,jBBContext.context)}function ImageRectOverlap(t,e,n,a,i,o,c){return jBBContext.context.imageRectOverlap(t,e,n,a,i,o,c)}function MouseX(){return jBBContext.context.mouseX()}function MouseY(){return jBBContext.context.mouseY()}function MouseHit(t){return jBBContext.context.mouseHit(t)}function MouseDown(t){return jBBContext.context.mouseDown(t)}function FlushMouse(){jBBContext.context.flushMouse()}function GetMouse(){return jBBContext.context.getMouse()}function KeyDown(t){return jBBContext.context.keyDown(t)}function KeyHit(t){return jBBContext.context.keyHit(t)}function FlushKeys(){jBBContext.context.flushKeys()}function MilliSecs(){return jBBContext.context.milliSecs()}function LoadMusic(t){return jBBContext.context.loadMusic(t)}function PlayMusic(t){t.play()}function OpenFile(t){return jBBContext.context.openFile(t)}!function(t){var e=function(){return function(){this.milliSecs=function(){return(new Date).getTime()},this.rand=function(t,e){return Math.floor(Math.random()*e)+t}}}();t.jTime=e}(jBB||(jBB={}));