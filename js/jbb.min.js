!function(t){var n=function(t,n,e,a){var i=this;void 0===t&&(t=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===a&&(a=1),this.red=0,this.green=0,this.blue=0,this.alpha=1,this.rgba=function(){return"rgba("+i.red+", "+i.green+", "+i.blue+", "+i.alpha+")"},this.set=function(t,n,e,a){void 0===t&&(t=0),void 0===n&&(n=0),void 0===e&&(e=0),void 0===a&&(a=1),i.red=t,i.green=n,i.blue=e,i.alpha=a},this.red=t,this.green=n,this.blue=e,this.alpha=a};(jBB||(jBB={})).jColor=n}(),function(t){var n=function(t,n,e){var o=this;this.set=function(t,n,e,a){void 0===t&&(t=16),void 0===n&&(n=!1),void 0===e&&(e=!1),void 0===a&&(a=0);var i="";1==n&&(i+=0<a?a:"bold "),1==e&&(i+="oblique "),o.ctx.data.canvas.ctx.font=i+t+"px "+o.name},this.draw=function(t,n,e){void 0===n&&(n=0),void 0===e&&(e=0),o.ctx.data.canvas.ctx.fillStyle=o.ctx.data.color.draw.rgba(),o.ctx.data.canvas.ctx.fillText(t,n,e)},this.ctx=e,this.name=n;var a=document.createElement("style");a.type="text/css",a.innerHTML="@font-face{ font-family: '"+this.name+"'; src: url("+t+"); }",document.body.appendChild(a)};(jBB||(jBB={})).jFont=n}(),function(t){var n=function(t,n,e,a,i,o){var u=this;this.img=new Image,this.loaded=!1,this.frame={num:1,width:0,height:0,start:1,current:1},this.hndl={x:0,y:0},this.autoMidHandle=!1,this.localMidHandle=!1,this.scaleFac={x:1,y:1},this.rotation=0,this.draw=function(t,n,e){void 0===e&&(e=1);var a=t,i=n;if(t/=u.scaleFac.x,n/=u.scaleFac.y,1==u.loaded){var o=u.getTilePos(e-1),c=t-u.hndl.x,s=n-u.hndl.y;(1==u.autoMidHandle||u.localMidHandle)&&(c-=u.frame.width/2,s-=u.frame.height/2),u.cnv.save(),u.cnv.translate(a,i),u.cnv.rotate(u.rotation*Math.PI/180),u.cnv.translate(-a,-i),u.cnv.scale(u.scaleFac.x,u.scaleFac.y),u.cnv.drawImage(u.img,o.x,o.y,u.frame.width,u.frame.height,c,s,u.frame.width,u.frame.height),u.cnv.scale(1,1),u.cnv.restore()}},this.handle=function(t,n){if(void 0===t&&(t=void 0),void 0===n&&(n=void 0),void 0===t)return 1==u.autoMidHandle||u.localMidHandle?{x:u.hndl.x+u.img.width/2,y:u.hndl.y+u.img.height/2}:u.hndl;t/=u.scaleFac.x,n/=u.scaleFac.y,u.hndl={x:t,y:n}},this.midHandle=function(t){u.localMidHandle=t},this.imageDataObject=function(){return u.ctx.clearBackbuffer(),u.ctx.data.canvas.bbf.drawImage(u.img,0,0),u.imgData=u.ctx.data.canvas.bbf.getImageData(0,0,u.img.width,u.img.height),u.imgData},this.width=function(){return u.img.width},this.height=function(){return u.img.height},this.rotate=function(t){u.rotation=t},this.scale=function(t,n){void 0===t&&(t=1),void 0===n&&(n=1),u.scaleFac={x:t,y:n}},this.rectOverlap=function(t,n,e,a,i,o){var c=t,s=n,d=t+u.img.width,r=n+u.img.height;return!(d<e||e+i<c||r<a||a+o<s)},this.cellsPerRow=function(){return Math.floor(u.img.width/u.frame.width)},this.getTilePos=function(t){return{x:t%u.cellsPerRow()*u.frame.width,y:Math.floor(t/u.cellsPerRow())*u.frame.height}},this.getTileIndex=function(t,n){return t/u.frame.width+n/u.frame.height*u.cellsPerRow()},this.ctx=o,this.cnv=this.ctx.data.canvas.ctx,this.autoMidHandle=this.ctx.data.global.autoMidHandle,"string"==typeof t?(this.img.src=t,"number"==typeof n&&(this.frame.width=n),"number"==typeof e&&(this.frame.height=e),this.frame.start=a,this.frame.num=i,this.ctx=o,this.img.onload=function(t){u.loaded=!0,1===u.frame.num&&(u.frame.width=u.img.width,u.frame.height=u.img.height)}):"number"==typeof t&&(this.img.width=t,this.img.height=n,this.frame.num=e,this.ctx=a,this.img=new Image(t,n))};(jBB||(jBB={})).jImage=n}(),function(c){var t=function(t,n,e){var o=this;this.data={ready:!1,lastID:0,canvas:{element:null,ctx:null,bbf:null,id:"",x:0,y:0,width:640,height:480},mainLoop:"main",color:{cls:new c.jColor,draw:new c.jColor(255,255,255,1)},global:{autoMidHandle:!1,alpha:1,scale:1},mouse:null,keyboard:null,time:new c.jTime,font:{current:null,default:null}},this.createBackbuffer=function(){var t=document.createElement("canvas"),n=document.createTextNode("backbuffer");t.appendChild(n),t.id=o.data.canvas.id+"-bbuf",t.width=o.data.canvas.width,t.height=o.data.canvas.height,t.style.display="none",o.data.canvas.bbf=t.getContext("2d"),document.body.appendChild(t)},this.clearBackbuffer=function(){o.data.canvas.ctx.fillStyle="rgba(0, 0, 0, 0)",o.data.canvas.ctx.setTransform(1,0,0,1,0,0),o.data.canvas.ctx.fillRect(0,0,o.data.canvas.width,o.data.canvas.height)},this.getCanvasElement=function(){o.data.canvas.element=document.getElementById(o.data.canvas.id)},this.createCanvasElement=function(){o.data.canvas.element=document.createElement("canvas"),o.data.canvas.element.id=o.data.canvas.id,o.data.canvas.element.width=o.data.canvas.width,o.data.canvas.element.height=o.data.canvas.height,o.data.canvas.element.appendChild(document.createTextNode("your browser doesn't support the canvas element")),document.body.appendChild(o.data.canvas.element)},this.preRender=function(){o.data.canvas.ctx.save()},this.postRender=function(){o.data.canvas.ctx.restore()},this.render=function(){window.requestAnimationFrame(o.render),o.preRender(),window[o.data.mainLoop](),o.postRender()},this.mouseX=function(){return o.data.mouse.x},this.mouseY=function(){return o.data.mouse.y},this.mouseDown=function(t){return o.data.mouse.down(t)},this.mouseHit=function(t){return o.data.mouse.hit(t)},this.flushMouse=function(){o.data.mouse.flush()},this.getMouse=function(){return o.data.mouse.get()},this.keyDown=function(t){return o.data.keyboard.down(t)},this.keyHit=function(t){return o.data.keyboard.hit(t)},this.flushKeys=function(){o.data.keyboard.flush()},this.milliSecs=function(){return o.data.time.milliSecs()},this.rand=function(t,n){return o.data.time.rand(t,n)},this.cls=function(){o.data.canvas.ctx.fillStyle=o.data.color.cls.rgba(),o.data.canvas.ctx.setTransform(1,0,0,1,0,0),o.data.canvas.ctx.fillRect(0,0,o.data.canvas.width,o.data.canvas.height)},this.clsColor=function(t,n,e){o.data.color.cls.set(t,n,e)},this.color=function(t,n,e,a){void 0===t&&(t=255),void 0===n&&(n=255),void 0===e&&(e=255),void 0===a&&(a=1),o.data.color.draw.set(t,n,e,a)},this.graphicsWidth=function(){return o.data.canvas.width},this.graphicsHeight=function(){return o.data.canvas.height},this.tFormFilter=function(t){o.data.canvas.ctx.imageSmoothingEnabled=t},this.rect=function(t,n,e,a,i){void 0===i&&(i=!0),i?(o.data.canvas.ctx.fillStyle=o.data.color.draw.rgba(),o.data.canvas.ctx.fillRect(t,n,e,a)):(o.data.canvas.ctx.strokeStyle=o.data.color.draw.rgba(),o.data.canvas.ctx.strokeRect(t,n,e,a))},this.line=function(t,n,e,a){o.data.canvas.ctx.strokeStyle=o.data.color.draw.rgba(),o.data.canvas.ctx.beginPath(),o.data.canvas.ctx.moveTo(t,n),o.data.canvas.ctx.lineTo(e,a),o.data.canvas.ctx.stroke()},this.loadFont=function(t,n){return o.data.font.current=new c.jFont(t,n,o),o.data.font.current},this.setFont=function(t,n,e,a,i){void 0===n&&(n=16),void 0===e&&(e=!1),void 0===a&&(a=!1),void 0===i&&(i=0),o.data.font.current=t,o.data.font.current.set(n,e,a,i)},this.drawText=function(t,n,e){void 0===n&&(n=0),void 0===e&&(e=0),o.data.font.current instanceof c.jFont?o.data.font.current.draw(t,n,e):o.data.font.default.draw(t,n,e)},this.autoMidHandle=function(t){o.data.global.autoMidHandle=t},this.midHandle=function(t,n){t.midHandle(n)},this.loadImage=function(t,n,e,a,i){return void 0===a&&(a=1),void 0===i&&(i=1),new c.jImage(t,n,e,a,i,o)},this.drawImage=function(t,n,e,a){void 0===a&&(a=1),t.draw(n,e,a)},this.imageWidth=function(t){return t.width()},this.imageHeight=function(t){return t.height()},this.rotateImage=function(t,n){t.rotate(n)},this.imageHandle=function(t){return 1==t.loaded?t.handle():0},this.scaleImage=function(t,n,e){void 0===n&&(n=1),void 0===e&&(e=1),t.scale(n,e)},this.createImage=function(t,n,e){return new c.jImage(t,n,e,o)},this.imageRectOverlap=function(t,n,e,a,i,o,c){return t.rectOverlap(n,e,a,i,o,c)},this.loadMusic=function(t){return new c.jMusic(t)},this.playMusic=function(t){t.play()},"number"==typeof t?(this.data.lastID++,this.data.canvas.id="jbbCanvas"+this.data.lastID,this.data.canvas.width=t,"number"==typeof n&&(this.data.canvas.height=n),"string"==typeof e&&(this.data.mainLoop=e),this.createCanvasElement()):"string"==typeof t&&(this.data.canvas.id=t,"string"==typeof n&&(this.data.mainLoop=n),this.getCanvasElement()),this.data.canvas.ctx=this.data.canvas.element.getContext("2d"),this.data.canvas.ctx.lineWidth=1,this.data.mouse=new c.jMouse(this),this.data.keyboard=new c.jKeyboard(this),this.data.font.default=new c.jFont("","Arial",this),window.onload=function(){o.data.ready=!0},this.createBackbuffer(),window.requestAnimationFrame(this.render)};c.Core=t}(jBB||(jBB={})),function(t){var n=function(t){var e=this;this.saveKeyDown=function(t){e.keys[t.keyCode]=!0},this.saveKeyUp=function(t){e.keys[t.keyCode]=!1},this.down=function(t){return e.keys[t]},this.hit=function(t){var n=e.keys[t];return e.keys[t]=!1,n},this.flush=function(){for(var t in e.keys)e.keys[t]=!1},this.ctx=t,this.ctx.data.canvas.element.onkeydown=this.saveKeyDown,this.ctx.data.canvas.element.onkeyup=this.saveKeyUp};(jBB||(jBB={})).jKeyboard=n}(),function(t){var n=function(t){var e=this;this.saveMousePos=function(t){var n=e.ctx.data.canvas.element.getBoundingClientRect();e.x=t.clientX-n.left,e.y=t.clientY-n.top},this.saveMouseDown=function(t){e.keys[t.button]=!0},this.saveMouseUp=function(t){e.keys[t.button]=!1},this.down=function(t){return e.keys[t]},this.hit=function(t){var n=e.keys[t];return e.keys[t]=!1,n},this.flush=function(){for(var t in e.keys)e.keys[t]=!1},this.get=function(){var t=[];for(var n in e.keys)e.keys[n]&&t.push(Number(n));return t},this.ctx=t,this.keys=[],this.ctx.data.canvas.element.onmousemove=this.saveMousePos,this.ctx.data.canvas.element.onmousedown=this.saveMouseDown,this.ctx.data.canvas.element.onmouseup=this.saveMouseUp};(jBB||(jBB={})).jMouse=n}(),function(t){var n=function(){function t(t,n,e){var a=this;void 0===t&&(t=""),void 0===n&&(n=!0),void 0===e&&(e=!0),this.loaded=!1,this.play=function(){a.music.play()},""!==t&&this.load(t)}return t.prototype.load=function(t,n,e){void 0===n&&(n=!0),void 0===e&&(e=!0),this.music=new Audio(t)},t}();t.jMusic=n}(jBB||(jBB={}));var jBB,jBBContext={context:void 0};function Graphics(t,n,e){void 0===t&&(t=640),void 0===n&&(n=480),void 0===e&&(e="main"),jBBContext.context=new jBB.Core(t,n,e)}function Cls(){jBBContext.context.cls()}function ClsColor(t,n,e){void 0===t&&(t=0),void 0===n&&(n=0),void 0===e&&(e=0),jBBContext.context.clsColor(t,n,e)}function Color(t,n,e,a){void 0===t&&(t=255),void 0===n&&(n=255),void 0===e&&(e=255),void 0===a&&(a=1),jBBContext.context.color(t,n,e,a)}function GraphicsWidth(){return jBBContext.context.graphicsWidth()}function GraphicsHeight(){return jBBContext.context.graphicsHeight()}function TFormFilter(t){jBBContext.context.tFormFilter(t)}function Rect(t,n,e,a,i){void 0===i&&(i=1);jBBContext.context.rect(t,n,e,a,i)}function Line(t,n,e,a){jBBContext.context.line(t,n,e,a)}function LoadFont(t,n){return jBBContext.context.loadFont(t,n)}function SetFont(t,n,e,a){void 0===n&&(n=16),void 0===e&&(e=!1),void 0===a&&(a=!1),jBBContext.context.setFont(t,n,e,a)}function DrawText(t,n,e){void 0===n&&(n=0),void 0===e&&(e=0),jBBContext.context.drawText(t,n,e)}function AutoMidHandle(t){jBBContext.context.autoMidHandle(t)}function MidHandle(t,n){jBBContext.context.midHandle(t,n)}function LoadImage(t,n,e,a,i){return void 0===a&&(a=1),void 0===i&&(i=1),jBBContext.context.loadImage(t,n,e,a,i)}function DrawImage(t,n,e,a){void 0===a&&(a=1),jBBContext.context.drawImage(t,n,e,a)}function HandleImage(t,n,e){t.handle(n,e)}function ImageWidth(t){return jBBContext.context.imageWidth(t)}function ImageHeight(t){return jBBContext.context.imageHeight(t)}function RotateImage(t,n){jBBContext.context.rotateImage(t,n)}function ImageXHandle(t){return jBBContext.context.imageHandle(t).x}function ImageYHandle(t){return jBBContext.context.imageHandle(t).y}function ScaleImage(t,n,e){void 0===n&&(n=1),void 0===e&&(e=1),jBBContext.context.scaleImage(t,n,e)}function CreateImage(t,n,e){return void 0===e&&(e=1),new jBB.jImage(t,n,e,jBBContext.context)}function ImageRectOverlap(t,n,e,a,i,o,c){return jBBContext.context.imageRectOverlap(t,n,e,a,i,o,c)}function MouseX(){return jBBContext.context.mouseX()}function MouseY(){return jBBContext.context.mouseY()}function MouseHit(t){return jBBContext.context.mouseHit(t)}function MouseDown(t){return jBBContext.context.mouseDown(t)}function FlushMouse(){jBBContext.context.flushMouse()}function GetMouse(){return jBBContext.context.getMouse()}function KeyDown(t){return jBBContext.context.keyDown(t)}function KeyHit(t){return jBBContext.context.keyHit(t)}function FlushKeys(){jBBContext.context.flushKeys()}function MilliSecs(){return jBBContext.context.milliSecs()}function LoadMusic(t){return jBBContext.context.loadMusic(t)}function PlayMusic(t){t.play()}!function(t){var n=function(){this.milliSecs=function(){return(new Date).getTime()},this.rand=function(t,n){return Math.floor(Math.random()*n)+t}};(jBB||(jBB={})).jTime=n}();